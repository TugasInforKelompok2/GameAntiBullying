<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hero Kebaikan - Petualangan Anti-Bullying</title>
    
    <!-- Favicon Hero Emoji -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶∏‚Äç‚ôÄÔ∏è</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'xs': '475px',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Comic+Neue:wght@400;700&display=swap');
        
        body {
            font-family: 'Comic Neue', cursive;
        }
        
        .game-title {
            font-family: 'Fredoka One', cursive;
        }
        
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(5deg); }
            70% { transform: scale(0.9) rotate(-2deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 1); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .level-up {
            animation: levelUp 1s ease-out;
        }
        
        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .mission-complete {
            animation: missionComplete 0.8s ease-out;
        }
        
        @keyframes missionComplete {
            0% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.95); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.8s ease-out;
        }
        
        @keyframes slideInLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        .slide-in-right {
            animation: slideInRight 0.8s ease-out;
        }
        
        @keyframes slideInRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        .slide-in-up {
            animation: slideInUp 0.8s ease-out;
        }
        
        @keyframes slideInUp {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .location-transition {
            position: relative;
            overflow: hidden;
        }
        
        .location-transition::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            transition: left 0.8s ease-out;
            z-index: 10;
        }
        
        .location-transition.transitioning::before {
            left: 100%;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-300 to-blue-400 min-h-screen">
    <!-- Game Header -->
    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 p-3 md:p-4 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <!-- Mobile Header -->
            <div class="flex flex-col space-y-3 md:hidden">
                <div class="flex justify-between items-center">
                    <h1 class="game-title text-xl text-white drop-shadow-lg">ü¶∏‚Äç‚ôÄÔ∏è HERO KEBAIKAN</h1>
                    <button id="saveMenuBtn" class="bg-white hover:bg-gray-100 text-purple-600 font-bold py-2 px-3 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        <span class="text-base">üíæ</span>
                    </button>
                </div>
                
                <!-- Mobile Stats -->
                <div class="grid grid-cols-3 gap-2">
                    <div class="bg-white rounded-full px-2 py-1 shadow-lg text-center">
                        <span class="text-xs font-bold text-purple-600">Lv: </span>
                        <span id="playerLevel" class="text-sm font-bold text-green-600">1</span>
                    </div>
                    <div class="bg-white rounded-full px-2 py-1 shadow-lg text-center">
                        <span class="text-xs font-bold text-purple-600">üíñ </span>
                        <span id="kindnessPoints" class="text-sm font-bold text-red-500">0</span>
                    </div>
                    <div class="bg-white rounded-full px-2 py-1 shadow-lg text-center">
                        <span class="text-xs font-bold text-purple-600">‚≠ê </span>
                        <span id="empathyLevel" class="text-xs font-bold text-yellow-500">Pemula</span>
                    </div>
                </div>
            </div>
            
            <!-- Desktop Header -->
            <div class="hidden md:flex justify-between items-center">
                <h1 class="game-title text-2xl lg:text-3xl text-white drop-shadow-lg">ü¶∏‚Äç‚ôÄÔ∏è HERO KEBAIKAN ü¶∏‚Äç‚ôÇÔ∏è</h1>
                
                <!-- Desktop Stats -->
                <div class="flex space-x-3 lg:space-x-4 items-center">
                    <div class="bg-white rounded-full px-3 lg:px-4 py-2 shadow-lg">
                        <span class="text-sm font-bold text-purple-600">Level: </span>
                        <span id="playerLevelDesktop" class="text-lg font-bold text-green-600">1</span>
                    </div>
                    <div class="bg-white rounded-full px-3 lg:px-4 py-2 shadow-lg">
                        <span class="text-sm font-bold text-purple-600">üíñ </span>
                        <span id="kindnessPointsDesktop" class="text-lg font-bold text-red-500">0</span>
                    </div>
                    <div class="bg-white rounded-full px-3 lg:px-4 py-2 shadow-lg">
                        <span class="text-sm font-bold text-purple-600">‚≠ê </span>
                        <span id="empathyLevelDesktop" class="text-lg font-bold text-yellow-500">Pemula</span>
                    </div>
                    
                    <!-- Save Menu Button -->
                    <button id="saveMenuBtnDesktop" class="bg-white hover:bg-gray-100 text-purple-600 font-bold py-2 px-4 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        <span class="text-lg">üíæ</span>
                        <span class="text-sm ml-1">Save</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto p-4">
        <!-- Game World Map -->
        <div class="bg-gradient-to-b from-sky-200 to-green-200 rounded-2xl md:rounded-3xl p-4 md:p-6 mb-4 md:mb-6 shadow-2xl relative overflow-hidden">
            <h2 class="text-xl md:text-2xl font-bold text-center text-purple-800 mb-4">üó∫Ô∏è Peta Petualangan Kebaikan</h2>
            
            <!-- Location Buttons -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 mb-4 md:mb-6">
                <button id="schoolBtn" class="location-btn bg-red-400 hover:bg-red-500 text-white font-bold py-4 md:py-6 px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                    <div class="text-3xl md:text-4xl mb-2">üè´</div>
                    <div class="text-base md:text-lg">Sekolah</div>
                    <div class="text-xs opacity-80">3 Misi Tersedia</div>
                </button>
                
                <button id="playgroundBtn" class="location-btn bg-green-400 hover:bg-green-500 text-white font-bold py-4 md:py-6 px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                    <div class="text-3xl md:text-4xl mb-2">üå≥</div>
                    <div class="text-base md:text-lg">Taman</div>
                    <div class="text-xs opacity-80">2 Misi Tersedia</div>
                </button>
                
                <button id="classroomBtn" class="location-btn bg-blue-400 hover:bg-blue-500 text-white font-bold py-4 md:py-6 px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                    <div class="text-3xl md:text-4xl mb-2">üìö</div>
                    <div class="text-base md:text-lg">Ruang Kelas</div>
                    <div class="text-xs opacity-80">4 Misi Tersedia</div>
                </button>
            </div>
        </div>

        <!-- Current Scene -->
        <div id="gameScene" class="bg-white rounded-2xl md:rounded-3xl p-4 md:p-8 mb-4 md:mb-6 shadow-2xl location-transition">
            <div id="sceneContent">
                <!-- Default Welcome Scene -->
                <div class="text-center">
                    <div class="text-6xl md:text-8xl mb-4 float">üåü</div>
                    <h3 class="text-xl md:text-3xl font-bold text-purple-800 mb-4">Selamat Datang, Hero Kebaikan!</h3>
                    <p class="text-base md:text-lg text-gray-700 mb-6 px-2">Pilih lokasi untuk memulai petualangan dan membantu teman-teman yang membutuhkan!</p>
                    
                    <!-- Hero Character -->
                    <div class="flex justify-center space-x-4 md:space-x-8 mb-6">
                        <div class="text-center">
                            <div class="text-4xl md:text-6xl mb-2">üòä</div>
                            <div class="bg-purple-500 text-white px-3 py-1 rounded-full text-xs md:text-sm font-bold">KAMU</div>
                            <div class="text-xs text-purple-600 mt-1">Hero Kebaikan Level 1</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sound Effects (Web Audio API) -->
        <div id="soundEffects" class="hidden">
            <!-- Sound effects will be generated programmatically -->
        </div>

        <!-- Action Panel -->
        <div id="actionPanel" class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-2xl hidden">
            <h3 class="text-lg md:text-2xl font-bold text-white text-center mb-4 md:mb-6">‚ö° Panel Aksi Hero</h3>
            <div id="actionButtons" class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4">
                <!-- Action buttons will be dynamically added here -->
            </div>
        </div>

        <!-- Mission Panel -->
        <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl md:rounded-3xl p-4 md:p-6 mt-4 md:mt-6 shadow-2xl">
            <h3 class="text-lg md:text-2xl font-bold text-white text-center mb-4 md:mb-6">üéØ Misi Aktif</h3>
            
            <div id="activeMissions" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
                <div class="mission-card bg-white rounded-xl md:rounded-2xl p-3 md:p-4 shadow-lg">
                    <div class="text-2xl md:text-3xl mb-2">ü§ù</div>
                    <h4 class="font-bold text-purple-800 mb-2 text-sm md:text-base">Temani Teman Baru</h4>
                    <p class="text-xs md:text-sm text-gray-600 mb-3">Ajak teman baru bermain bersama</p>
                    <div class="bg-gray-200 rounded-full h-2 mb-2">
                        <div class="bg-green-500 h-2 rounded-full w-0" id="mission1Progress"></div>
                    </div>
                    <div class="text-xs text-gray-500">Progress: 0/1</div>
                </div>
                
                <div class="mission-card bg-white rounded-xl md:rounded-2xl p-3 md:p-4 shadow-lg">
                    <div class="text-2xl md:text-3xl mb-2">üí™</div>
                    <h4 class="font-bold text-purple-800 mb-2 text-sm md:text-base">Beri Semangat</h4>
                    <p class="text-xs md:text-sm text-gray-600 mb-3">Hibur teman yang sedang sedih</p>
                    <div class="bg-gray-200 rounded-full h-2 mb-2">
                        <div class="bg-blue-500 h-2 rounded-full w-0" id="mission2Progress"></div>
                    </div>
                    <div class="text-xs text-gray-500">Progress: 0/2</div>
                </div>
                
                <div class="mission-card bg-white rounded-xl md:rounded-2xl p-3 md:p-4 shadow-lg sm:col-span-2 lg:col-span-1">
                    <div class="text-2xl md:text-3xl mb-2">üì¢</div>
                    <h4 class="font-bold text-purple-800 mb-2 text-sm md:text-base">Laporkan Pembully</h4>
                    <p class="text-xs md:text-sm text-gray-600 mb-3">Beritahu guru tentang bullying</p>
                    <div class="bg-gray-200 rounded-full h-2 mb-2">
                        <div class="bg-red-500 h-2 rounded-full w-0" id="mission3Progress"></div>
                    </div>
                    <div class="text-xs text-gray-500">Progress: 0/1</div>
                </div>
            </div>
        </div>

        <!-- Level Up Panel -->
        <div id="levelUpPanel" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-3xl p-8 shadow-2xl max-w-md mx-4 text-center">
                <div class="text-8xl mb-4">üéâ</div>
                <h3 class="text-3xl font-bold text-white mb-4">LEVEL UP!</h3>
                <p class="text-lg text-white mb-6">Selamat! Empati kamu meningkat!</p>
                <div id="levelUpReward" class="bg-white rounded-2xl p-4 mb-6">
                    <!-- Reward content will be added here -->
                </div>
                <button id="closeLevelUp" class="bg-white text-orange-600 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-100 transform hover:scale-105 transition-all duration-300">
                    Lanjutkan Petualangan! üöÄ
                </button>
            </div>
        </div>

        <!-- Save Menu Panel -->
        <div id="saveMenuPanel" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl md:rounded-3xl p-4 md:p-8 shadow-2xl max-w-lg w-full max-h-screen overflow-y-auto">
                <div class="text-center mb-4 md:mb-6">
                    <div class="text-4xl md:text-6xl mb-2 md:mb-4">üíæ</div>
                    <h3 class="text-xl md:text-3xl font-bold text-white mb-2">Menu Save Game</h3>
                    <p class="text-sm md:text-base text-white opacity-90">Kelola progress permainan kamu</p>
                </div>

                <!-- Save Info -->
                <div id="saveInfo" class="bg-white rounded-xl md:rounded-2xl p-3 md:p-4 mb-4 md:mb-6">
                    <h4 class="font-bold text-purple-800 mb-3 text-sm md:text-base">üìä Info Progress</h4>
                    <div class="grid grid-cols-2 gap-2 md:gap-4 text-xs md:text-sm">
                        <div>
                            <span class="text-gray-600">Level:</span>
                            <span id="saveInfoLevel" class="font-bold text-green-600 ml-1 md:ml-2">1</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Poin:</span>
                            <span id="saveInfoPoints" class="font-bold text-red-500 ml-1 md:ml-2">0</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Waktu Main:</span>
                            <span id="saveInfoTime" class="font-bold text-blue-600 ml-1 md:ml-2">0m</span>
                        </div>
                        <div>
                            <span class="text-gray-600">Terakhir Main:</span>
                            <span id="saveInfoDate" class="font-bold text-purple-600 ml-1 md:ml-2">Hari ini</span>
                        </div>
                    </div>
                </div>

                <!-- Save Actions -->
                <div class="grid grid-cols-2 gap-2 md:gap-4 mb-4 md:mb-6">
                    <button id="manualSaveBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 md:py-3 px-2 md:px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                        <div class="text-lg md:text-2xl mb-1">üíæ</div>
                        <div class="text-xs md:text-sm">Save Manual</div>
                    </button>
                    
                    <button id="exportSaveBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 md:py-3 px-2 md:px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                        <div class="text-lg md:text-2xl mb-1">üì§</div>
                        <div class="text-xs md:text-sm">Export Save</div>
                    </button>
                    
                    <button id="importSaveBtn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 md:py-3 px-2 md:px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                        <div class="text-lg md:text-2xl mb-1">üì•</div>
                        <div class="text-xs md:text-sm">Import Save</div>
                    </button>
                    
                    <button id="resetGameBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 md:py-3 px-2 md:px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95">
                        <div class="text-lg md:text-2xl mb-1">üóëÔ∏è</div>
                        <div class="text-xs md:text-sm">Reset Game</div>
                    </button>
                </div>

                <!-- Auto Save Status -->
                <div class="bg-white bg-opacity-20 rounded-xl md:rounded-2xl p-3 md:p-4 mb-4 md:mb-6">
                    <div class="flex items-center justify-between text-white">
                        <div class="flex items-center">
                            <span class="text-lg md:text-2xl mr-2">üîÑ</span>
                            <span class="font-bold text-sm md:text-base">Auto Save</span>
                        </div>
                        <div class="text-xs md:text-sm opacity-90">Setiap 30 detik</div>
                    </div>
                    <div class="text-xs text-white opacity-75 mt-2">
                        Progress otomatis tersimpan di browser kamu
                    </div>
                </div>

                <!-- Hidden file input for import -->
                <input type="file" id="importFileInput" accept=".json" class="hidden">

                <!-- Close Button -->
                <div class="text-center">
                    <button id="closeSaveMenu" class="bg-white text-purple-600 font-bold py-2 md:py-3 px-6 md:px-8 rounded-full shadow-lg hover:bg-gray-100 transform hover:scale-105 transition-all duration-300 active:scale-95 text-sm md:text-base">
                        Tutup Menu üöÄ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State with Save System
        let gameState = {
            playerLevel: 1,
            kindnessPoints: 0,
            empathyLevel: 'Pemula',
            currentLocation: null,
            missions: {
                befriendNew: { progress: 0, target: 1, completed: false },
                giveSupport: { progress: 0, target: 2, completed: false },
                reportBully: { progress: 0, target: 1, completed: false }
            },
            achievements: [],
            totalPlayTime: 0,
            lastPlayed: null,
            scenariosCompleted: 0
        };

        // Save System Class
        class SaveSystem {
            constructor() {
                this.saveKey = 'heroKebaikanSave';
                this.autoSaveInterval = 30000; // Auto-save every 30 seconds
                this.startAutoSave();
            }

            saveGame() {
                try {
                    const saveData = {
                        ...gameState,
                        lastPlayed: new Date().toISOString(),
                        version: '1.0'
                    };
                    localStorage.setItem(this.saveKey, JSON.stringify(saveData));
                    this.showSaveNotification();
                    return true;
                } catch (error) {
                    console.error('Failed to save game:', error);
                    return false;
                }
            }

            loadGame() {
                try {
                    const savedData = localStorage.getItem(this.saveKey);
                    if (savedData) {
                        const parsedData = JSON.parse(savedData);
                        
                        // Merge saved data with current state
                        Object.keys(parsedData).forEach(key => {
                            if (key !== 'version') {
                                gameState[key] = parsedData[key];
                            }
                        });
                        
                        this.showLoadNotification();
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('Failed to load game:', error);
                    return false;
                }
            }

            resetGame() {
                if (confirm('üö® Yakin ingin menghapus semua progress? Data tidak bisa dikembalikan!')) {
                    localStorage.removeItem(this.saveKey);
                    location.reload();
                }
            }

            exportSave() {
                try {
                    const saveData = localStorage.getItem(this.saveKey);
                    if (saveData) {
                        const blob = new Blob([saveData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `hero-kebaikan-save-${new Date().toISOString().split('T')[0]}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        this.showNotification('üíæ Save file berhasil diunduh!', 'success');
                    }
                } catch (error) {
                    this.showNotification('‚ùå Gagal mengunduh save file!', 'error');
                }
            }

            importSave(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const saveData = JSON.parse(e.target.result);
                        localStorage.setItem(this.saveKey, JSON.stringify(saveData));
                        this.showNotification('‚úÖ Save file berhasil dimuat! Refresh halaman.', 'success');
                        setTimeout(() => location.reload(), 2000);
                    } catch (error) {
                        this.showNotification('‚ùå File save tidak valid!', 'error');
                    }
                };
                reader.readAsText(file);
            }

            startAutoSave() {
                setInterval(() => {
                    this.saveGame();
                }, this.autoSaveInterval);
            }

            showSaveNotification() {
                this.showNotification('üíæ Progress tersimpan!', 'success');
            }

            showLoadNotification() {
                this.showNotification('üìÇ Progress dimuat!', 'info');
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white font-bold transform translate-x-full transition-transform duration-300 ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                }`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            getPlayTime() {
                const minutes = Math.floor(gameState.totalPlayTime / 60);
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                
                if (hours > 0) {
                    return `${hours}j ${remainingMinutes}m`;
                }
                return `${minutes}m`;
            }

            getSaveInfo() {
                const savedData = localStorage.getItem(this.saveKey);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    return {
                        lastPlayed: new Date(data.lastPlayed).toLocaleDateString('id-ID'),
                        level: data.playerLevel,
                        points: data.kindnessPoints,
                        playTime: this.getPlayTime()
                    };
                }
                return null;
            }
        }

        // Initialize save system
        const saveSystem = new SaveSystem();

        // Sound System using Web Audio API
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.init();
            }

            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            createSounds() {
                // Create different sound effects using oscillators
                this.sounds = {
                    click: () => this.playTone(800, 0.1, 'sine'),
                    success: () => this.playChord([523, 659, 784], 0.3, 'sine'),
                    levelUp: () => this.playMelody([523, 659, 784, 1047], 0.15, 'triangle'),
                    transition: () => this.playSwipe(),
                    error: () => this.playTone(200, 0.2, 'sawtooth'),
                    mission: () => this.playTone(1000, 0.15, 'triangle')
                };
            }

            playTone(frequency, duration, type = 'sine') {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            playChord(frequencies, duration, type = 'sine') {
                frequencies.forEach((freq, index) => {
                    setTimeout(() => this.playTone(freq, duration, type), index * 50);
                });
            }

            playMelody(frequencies, noteDuration, type = 'sine') {
                frequencies.forEach((freq, index) => {
                    setTimeout(() => this.playTone(freq, noteDuration, type), index * noteDuration * 1000);
                });
            }

            playSwipe() {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.3);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + 0.3);
            }

            play(soundName) {
                if (this.sounds[soundName]) {
                    this.sounds[soundName]();
                }
            }
        }

        // Initialize sound system
        const soundSystem = new SoundSystem();

        // Game Scenarios
        const scenarios = {
            school: [
                {
                    title: "Teman Baru di Koridor",
                    description: "Kamu melihat anak baru berdiri sendiri di koridor. Dia terlihat bingung dan kesepian.",
                    characters: [
                        { emoji: "üòü", name: "Anak Baru", dialogue: "Aku tidak tahu harus ke mana..." },
                        { emoji: "üòä", name: "KAMU", dialogue: "Apa yang harus kulakukan?" }
                    ],
                    actions: [
                        { text: "Ajak Bicara", type: "befriend", points: 15, correct: true },
                        { text: "Tunjukkan Jalan", type: "help", points: 10, correct: true },
                        { text: "Abaikan", type: "ignore", points: -5, correct: false },
                        { text: "Panggil Teman Lain", type: "social", points: 20, correct: true }
                    ]
                },
                {
                    title: "Bullying di Kantin",
                    description: "Seorang anak besar mengambil bekal temanmu dan tidak mau mengembalikannya.",
                    characters: [
                        { emoji: "üò°", name: "Pembully", dialogue: "Bekalmu jelek! Aku ambil saja!" },
                        { emoji: "üò¢", name: "Korban", dialogue: "Kembalikan bekalku..." },
                        { emoji: "üò†", name: "KAMU", dialogue: "Ini tidak boleh dibiarkan!" }
                    ],
                    actions: [
                        { text: "Laporkan ke Guru", type: "report", points: 25, correct: true },
                        { text: "Bela Teman", type: "defend", points: 20, correct: true },
                        { text: "Ajak Pergi", type: "escape", points: 10, correct: false },
                        { text: "Diam Saja", type: "ignore", points: -10, correct: false }
                    ]
                }
            ],
            playground: [
                {
                    title: "Teman Terjatuh",
                    description: "Temanmu terjatuh saat bermain dan lututnya berdarah. Dia menangis kesakitan.",
                    characters: [
                        { emoji: "üò≠", name: "Teman", dialogue: "Aduh... sakit sekali!" },
                        { emoji: "üòü", name: "KAMU", dialogue: "Aku harus membantu!" }
                    ],
                    actions: [
                        { text: "Panggil Guru", type: "help", points: 20, correct: true },
                        { text: "Hibur Dia", type: "comfort", points: 15, correct: true },
                        { text: "Cari Obat", type: "medical", points: 25, correct: true },
                        { text: "Tinggalkan", type: "ignore", points: -15, correct: false }
                    ]
                }
            ],
            classroom: [
                {
                    title: "Teman Kesulitan Belajar",
                    description: "Temanmu tidak mengerti pelajaran matematika dan terlihat frustasi.",
                    characters: [
                        { emoji: "üò∞", name: "Teman", dialogue: "Aku tidak mengerti sama sekali..." },
                        { emoji: "ü§î", name: "KAMU", dialogue: "Mungkin aku bisa membantu?" }
                    ],
                    actions: [
                        { text: "Ajari Dia", type: "teach", points: 20, correct: true },
                        { text: "Beri Semangat", type: "encourage", points: 15, correct: true },
                        { text: "Minta Tolong Guru", type: "help", points: 18, correct: true },
                        { text: "Biarkan Saja", type: "ignore", points: -5, correct: false }
                    ]
                }
            ]
        };

        // DOM Elements
        const playerLevelEl = document.getElementById('playerLevel');
        const kindnessPointsEl = document.getElementById('kindnessPoints');
        const empathyLevelEl = document.getElementById('empathyLevel');
        const sceneContent = document.getElementById('sceneContent');
        const actionPanel = document.getElementById('actionPanel');
        const actionButtons = document.getElementById('actionButtons');
        const levelUpPanel = document.getElementById('levelUpPanel');

        // Location buttons
        const schoolBtn = document.getElementById('schoolBtn');
        const playgroundBtn = document.getElementById('playgroundBtn');
        const classroomBtn = document.getElementById('classroomBtn');

        // Initialize game
        function updateUI() {
            // Update mobile stats
            playerLevelEl.textContent = gameState.playerLevel;
            kindnessPointsEl.textContent = gameState.kindnessPoints;
            empathyLevelEl.textContent = gameState.empathyLevel;
            
            // Update desktop stats
            const playerLevelDesktop = document.getElementById('playerLevelDesktop');
            const kindnessPointsDesktop = document.getElementById('kindnessPointsDesktop');
            const empathyLevelDesktop = document.getElementById('empathyLevelDesktop');
            
            if (playerLevelDesktop) playerLevelDesktop.textContent = gameState.playerLevel;
            if (kindnessPointsDesktop) kindnessPointsDesktop.textContent = gameState.kindnessPoints;
            if (empathyLevelDesktop) empathyLevelDesktop.textContent = gameState.empathyLevel;
            
            updateSaveInfo();
        }

        function updateSaveInfo() {
            document.getElementById('saveInfoLevel').textContent = gameState.playerLevel;
            document.getElementById('saveInfoPoints').textContent = gameState.kindnessPoints;
            document.getElementById('saveInfoTime').textContent = saveSystem.getPlayTime();
            
            const saveInfo = saveSystem.getSaveInfo();
            if (saveInfo) {
                document.getElementById('saveInfoDate').textContent = saveInfo.lastPlayed;
            }
        }

        function showSaveMenu() {
            updateSaveInfo();
            document.getElementById('saveMenuPanel').classList.remove('hidden');
            soundSystem.play('click');
        }

        function hideSaveMenu() {
            document.getElementById('saveMenuPanel').classList.add('hidden');
            soundSystem.play('click');
        }

        function showScenario(location, scenarioIndex = 0) {
            // Play transition sound
            soundSystem.play('transition');
            
            // Start transition effect
            const gameScene = document.getElementById('gameScene');
            gameScene.classList.add('transitioning');
            
            // Fade out current content
            sceneContent.classList.add('fade-out');
            
            setTimeout(() => {
                const scenario = scenarios[location][scenarioIndex];
                gameState.currentLocation = location;
                
                // Get location-specific background
                const locationBg = getLocationBackground(location);
                gameScene.style.background = locationBg;
                
                sceneContent.innerHTML = `
                    <div class="text-center mb-4 md:mb-6">
                        <div class="text-3xl md:text-4xl mb-2">${getLocationEmoji(location)}</div>
                        <h3 class="text-lg md:text-2xl font-bold text-purple-800 mb-3 md:mb-4 px-2">${scenario.title}</h3>
                        <p class="text-sm md:text-lg text-gray-700 mb-4 md:mb-6 px-2">${scenario.description}</p>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 md:space-x-6 mb-6 md:mb-8">
                        ${scenario.characters.map((char, index) => `
                            <div class="text-center ${getCharacterAnimation(index)}">
                                <div class="text-4xl md:text-6xl mb-2">${char.emoji}</div>
                                <div class="bg-purple-500 text-white px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-bold mb-2">${char.name}</div>
                                <div class="bg-white border-2 border-purple-300 rounded-lg p-2 md:p-3 shadow-lg max-w-xs mx-auto">
                                    <p class="text-xs md:text-sm text-purple-700 font-semibold">"${char.dialogue}"</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // Remove fade-out and add fade-in
                sceneContent.classList.remove('fade-out');
                sceneContent.classList.add('fade-in');
                
                // Show action panel with slide animation
                actionPanel.classList.remove('hidden');
                actionPanel.classList.add('slide-in-up');
                
                actionButtons.innerHTML = scenario.actions.map((action, index) => `
                    <button class="action-btn bg-gradient-to-b from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 text-white font-bold py-3 md:py-4 px-3 md:px-4 rounded-xl md:rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 active:scale-95" 
                            data-action="${action.type}" data-points="${action.points}" data-correct="${action.correct}"
                            style="animation-delay: ${index * 0.1}s">
                        <div class="text-xl md:text-2xl mb-1 md:mb-2">${getActionEmoji(action.type)}</div>
                        <div class="text-xs md:text-sm">${action.text}</div>
                    </button>
                `).join('');
                
                // Add event listeners to action buttons
                document.querySelectorAll('.action-btn').forEach((btn, index) => {
                    btn.addEventListener('click', handleAction);
                    btn.classList.add('bounce-in');
                    btn.addEventListener('mouseenter', () => soundSystem.play('click'));
                });
                
                // Remove transition effect
                setTimeout(() => {
                    gameScene.classList.remove('transitioning');
                    sceneContent.classList.remove('fade-in');
                    actionPanel.classList.remove('slide-in-up');
                }, 600);
                
            }, 500);
        }

        function getLocationBackground(location) {
            const backgrounds = {
                school: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #f59e0b 100%)',
                playground: 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 50%, #22c55e 100%)',
                classroom: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #3b82f6 100%)'
            };
            return backgrounds[location] || 'linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)';
        }

        function getLocationEmoji(location) {
            const emojis = {
                school: 'üè´',
                playground: 'üå≥',
                classroom: 'üìö'
            };
            return emojis[location] || 'üè†';
        }

        function getCharacterAnimation(index) {
            const animations = ['slide-in-left', 'slide-in-up', 'slide-in-right'];
            return animations[index % animations.length];
        }

        function getActionEmoji(actionType) {
            const emojis = {
                befriend: 'ü§ù', help: 'üÜò', ignore: 'üôà', social: 'üë•',
                report: 'üì¢', defend: 'üõ°Ô∏è', escape: 'üèÉ', comfort: 'üíù',
                teach: 'üìñ', encourage: 'üí™', medical: 'üè•'
            };
            return emojis[actionType] || '‚≠ê';
        }

        function handleAction(event) {
            const btn = event.currentTarget;
            const actionType = btn.dataset.action;
            const points = parseInt(btn.dataset.points);
            const isCorrect = btn.dataset.correct === 'true';
            
            // Play sound effect
            soundSystem.play(isCorrect ? 'success' : 'error');
            
            // Add visual feedback
            btn.classList.add(isCorrect ? 'bounce-in' : 'shake');
            
            // Update game state
            gameState.kindnessPoints += points;
            gameState.scenariosCompleted++;
            
            // Update mission progress
            updateMissionProgress(actionType);
            
            // Show feedback
            setTimeout(() => {
                showActionFeedback(actionType, points, isCorrect);
            }, 500);
            
            // Check for level up
            checkLevelUp();
            
            // Auto-save progress
            saveSystem.saveGame();
            
            updateUI();
        }

        function updateMissionProgress(actionType) {
            const missionMap = {
                befriend: 'befriendNew',
                social: 'befriendNew',
                comfort: 'giveSupport',
                encourage: 'giveSupport',
                report: 'reportBully'
            };
            
            const missionKey = missionMap[actionType];
            if (missionKey && !gameState.missions[missionKey].completed) {
                gameState.missions[missionKey].progress++;
                
                // Play mission progress sound
                soundSystem.play('mission');
                
                if (gameState.missions[missionKey].progress >= gameState.missions[missionKey].target) {
                    gameState.missions[missionKey].completed = true;
                    gameState.kindnessPoints += 50; // Bonus for completing mission
                    showMissionComplete(missionKey);
                }
                
                updateMissionUI();
            }
        }

        function updateMissionUI() {
            const progressBars = {
                befriendNew: document.getElementById('mission1Progress'),
                giveSupport: document.getElementById('mission2Progress'),
                reportBully: document.getElementById('mission3Progress')
            };
            
            Object.keys(gameState.missions).forEach(key => {
                const mission = gameState.missions[key];
                const progressBar = progressBars[key];
                if (progressBar) {
                    const percentage = (mission.progress / mission.target) * 100;
                    progressBar.style.width = `${Math.min(percentage, 100)}%`;
                    
                    if (mission.completed) {
                        progressBar.parentElement.parentElement.classList.add('mission-complete');
                        progressBar.parentElement.parentElement.style.background = 'linear-gradient(135deg, #10B981, #059669)';
                        progressBar.parentElement.parentElement.style.color = 'white';
                    }
                }
            });
        }

        function showActionFeedback(actionType, points, isCorrect) {
            const feedbackMessages = {
                befriend: { good: "Luar biasa! Kamu membuat teman baru merasa diterima!", bad: "Coba pikirkan perasaan teman baru itu." },
                help: { good: "Hebat! Membantu orang lain adalah tindakan mulia!", bad: "Membantu orang lain selalu lebih baik." },
                report: { good: "Keputusan yang tepat! Melaporkan bullying sangat penting!", bad: "Bullying harus dilaporkan ke orang dewasa." },
                comfort: { good: "Kamu sangat peduli! Menghibur teman adalah hal yang baik!", bad: "Teman yang sedih butuh dukungan." }
            };
            
            const message = feedbackMessages[actionType] || { good: "Tindakan yang baik!", bad: "Coba pikirkan lagi." };
            const feedback = isCorrect ? message.good : message.bad;
            
            sceneContent.innerHTML = `
                <div class="text-center">
                    <div class="text-8xl mb-4">${isCorrect ? 'üåü' : 'üí≠'}</div>
                    <h3 class="text-2xl font-bold ${isCorrect ? 'text-green-600' : 'text-orange-600'} mb-4">
                        ${isCorrect ? 'Pilihan Hebat!' : 'Coba Lagi!'}
                    </h3>
                    <p class="text-lg text-gray-700 mb-4">${feedback}</p>
                    <div class="text-xl font-bold ${points > 0 ? 'text-green-600' : 'text-red-600'} mb-6">
                        ${points > 0 ? '+' : ''}${points} Poin Kebaikan
                    </div>
                    <button id="continueBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        Lanjutkan Petualangan! üöÄ
                    </button>
                </div>
            `;
            
            document.getElementById('continueBtn').addEventListener('click', () => {
                showWelcomeScene();
                actionPanel.classList.add('hidden');
            });
        }

        function checkLevelUp() {
            const newLevel = Math.floor(gameState.kindnessPoints / 100) + 1;
            if (newLevel > gameState.playerLevel) {
                gameState.playerLevel = newLevel;
                
                // Update empathy level
                if (gameState.playerLevel >= 5) gameState.empathyLevel = 'Master Empati';
                else if (gameState.playerLevel >= 3) gameState.empathyLevel = 'Ahli Kebaikan';
                else if (gameState.playerLevel >= 2) gameState.empathyLevel = 'Sahabat Baik';
                
                showLevelUp();
            }
        }

        function showLevelUp() {
            // Play level up sound
            soundSystem.play('levelUp');
            
            const rewards = [
                "Kemampuan Empati Meningkat!",
                "Unlock: Misi Spesial Baru!",
                "Bonus: 25 Poin Kebaikan!",
                "Achievement: Hero Sejati!"
            ];
            
            document.getElementById('levelUpReward').innerHTML = `
                <div class="text-4xl mb-2">üèÜ</div>
                <p class="font-bold text-purple-800">${rewards[Math.floor(Math.random() * rewards.length)]}</p>
            `;
            
            levelUpPanel.classList.remove('hidden');
            levelUpPanel.classList.add('bounce-in');
            gameState.kindnessPoints += 25; // Level up bonus
        }

        function showMissionComplete(missionKey) {
            const missionNames = {
                befriendNew: "Temani Teman Baru",
                giveSupport: "Beri Semangat",
                reportBully: "Laporkan Pembully"
            };
            
            // Show mission complete animation
            setTimeout(() => {
                alert(`üéâ Misi "${missionNames[missionKey]}" Selesai! +50 Poin Bonus!`);
            }, 1000);
        }

        function showWelcomeScene() {
            // Play transition sound
            soundSystem.play('transition');
            
            // Reset background to default
            const gameScene = document.getElementById('gameScene');
            gameScene.style.background = 'white';
            gameScene.classList.add('transitioning');
            
            // Fade out current content
            sceneContent.classList.add('fade-out');
            
            setTimeout(() => {
                sceneContent.innerHTML = `
                    <div class="text-center">
                        <div class="text-6xl md:text-8xl mb-4 float">üåü</div>
                        <h3 class="text-xl md:text-3xl font-bold text-purple-800 mb-4 px-2">Pilih Lokasi Petualangan!</h3>
                        <p class="text-sm md:text-lg text-gray-700 mb-6 px-2">Dimana kamu ingin membantu teman-teman hari ini?</p>
                        
                        <div class="flex justify-center space-x-4 md:space-x-8 mb-6">
                            <div class="text-center slide-in-up">
                                <div class="text-4xl md:text-6xl mb-2">üòä</div>
                                <div class="bg-purple-500 text-white px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-bold">KAMU</div>
                                <div class="text-xs text-purple-600 mt-1">Hero Kebaikan Level ${gameState.playerLevel}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Remove fade-out and add fade-in
                sceneContent.classList.remove('fade-out');
                sceneContent.classList.add('fade-in');
                
                // Remove transition effect
                setTimeout(() => {
                    gameScene.classList.remove('transitioning');
                    sceneContent.classList.remove('fade-in');
                }, 600);
                
            }, 500);
        }

        // Event Listeners
        schoolBtn.addEventListener('click', () => {
            soundSystem.play('click');
            showScenario('school', Math.floor(Math.random() * scenarios.school.length));
        });
        
        playgroundBtn.addEventListener('click', () => {
            soundSystem.play('click');
            showScenario('playground', 0);
        });
        
        classroomBtn.addEventListener('click', () => {
            soundSystem.play('click');
            showScenario('classroom', 0);
        });

        document.getElementById('closeLevelUp').addEventListener('click', () => {
            soundSystem.play('click');
            levelUpPanel.classList.add('hidden');
            levelUpPanel.classList.remove('bounce-in');
            updateUI();
        });

        // Save System Event Listeners
        document.getElementById('saveMenuBtn').addEventListener('click', showSaveMenu);
        document.getElementById('saveMenuBtnDesktop').addEventListener('click', showSaveMenu);
        document.getElementById('closeSaveMenu').addEventListener('click', hideSaveMenu);
        
        document.getElementById('manualSaveBtn').addEventListener('click', () => {
            soundSystem.play('success');
            saveSystem.saveGame();
            updateSaveInfo();
        });
        
        document.getElementById('exportSaveBtn').addEventListener('click', () => {
            soundSystem.play('click');
            saveSystem.exportSave();
        });
        
        document.getElementById('importSaveBtn').addEventListener('click', () => {
            soundSystem.play('click');
            document.getElementById('importFileInput').click();
        });
        
        document.getElementById('importFileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                saveSystem.importSave(file);
            }
        });
        
        document.getElementById('resetGameBtn').addEventListener('click', () => {
            soundSystem.play('error');
            saveSystem.resetGame();
        });

        // Add hover sounds to location buttons
        [schoolBtn, playgroundBtn, classroomBtn].forEach(btn => {
            btn.addEventListener('mouseenter', () => {
                soundSystem.play('click');
            });
        });

        // Add floating animation to location buttons
        document.querySelectorAll('.location-btn').forEach((btn, index) => {
            btn.style.animationDelay = `${index * 0.2}s`;
            btn.classList.add('float');
        });

        // Play Time Tracking
        let playTimeStart = Date.now();
        setInterval(() => {
            gameState.totalPlayTime += 1; // Add 1 second
        }, 1000);

        // Load saved game on startup
        if (saveSystem.loadGame()) {
            updateUI();
            updateMissionUI();
        }

        // Initialize game
        updateUI();
        updateMissionUI();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a67ec7c0093e59',t:'MTc1NDM5OTAxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
